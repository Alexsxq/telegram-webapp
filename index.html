<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>üîé –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
  <script src="https://telegram.org/js/telegram-web-app.js" defer></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 480px;
      margin: 40px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 20px;
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-size: 14px;
      color: #444;
      display: block;
      margin-bottom: 4px;
    }
    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 12px;
      background-color: #007aff;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #0062cc;
    }
    .result {
      margin-top: 16px;
      padding: 12px;
      background: #e0f7e9;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }
    .error {
      color: #ff3b30;
      margin-top: 8px;
      font-size: 14px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîé –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
    <label for="input">–í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ –Ω–æ–º–µ—Ä:</label>
    <input type="text" id="input" placeholder="@username –∏–ª–∏ –Ω–æ–º–µ—Ä" inputmode="search">
    <button id="check-btn" type="button">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <div id="result" class="result" role="status" aria-live="polite"></div>
    <div id="error" class="error" role="alert" aria-live="assertive"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('input');
      const btn = document.getElementById('check-btn');
      const result = document.getElementById('result');
      const error = document.getElementById('error');

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
      if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BackButton, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (tg.BackButton) {
          tg.BackButton.show();
          tg.BackButton.onClick(() => {
            tg.close();
          });
        }
      }

      function handleCheck() {
        const value = input.value.trim();
        error.style.display = 'none';
        result.style.display = 'none';

        if (!value) {
          error.textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –Ω–æ–º–µ—Ä.';
          error.style.display = 'block';
          input.focus();
          return;
        }

        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞
        const sanitizedValue = value.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        const message = `–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${sanitizedValue} ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ.`;

        result.innerHTML = message;
        result.style.display = 'block';

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram –±–æ—Ç–∞, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.sendData) {
          try {
            window.Telegram.WebApp.sendData(JSON.stringify({
              type: 'user_check',
              value: sanitizedValue
            }));
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:', e);
          }
        }
      }

      btn.addEventListener('click', handleCheck);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          handleCheck();
        }
      });
    });
  </script>
</body>
</html>
